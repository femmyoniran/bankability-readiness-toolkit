{% extends "base.html" %}
{% block title %}Financing Structures - {{ project_name }}{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Financing Structure Analysis</h1>
    <p>{{ project_name }} | {{ capacity_mw }} MW {{ technology }}</p>
</div>

<!-- Recommended Structures -->
<section class="results-section">
    <h2>Recommended Structures</h2>
    <p>Based on the project parameters, the following financing structures are ranked by fit.</p>
    <div class="structure-grid">
        {% for structure in structures %}
        <div class="structure-card {% if loop.index == 1 %}structure-best{% endif %}">
            {% if loop.index == 1 %}
            <span class="best-fit-badge">Best Fit</span>
            {% endif %}
            <div class="structure-header">
                <h3>{{ structure.name }}</h3>
                <span class="fit-score">{{ structure.fit_score }}/100</span>
            </div>
            <p class="structure-description">{{ structure.description }}</p>
            <div class="structure-details">
                <table class="compact-table">
                    <tr><td>Structure Type</td><td>{{ structure.type }}</td></tr>
                    <tr><td>Typical Leverage</td><td>{{ structure.typical_leverage }}</td></tr>
                    <tr><td>Tenor Range</td><td>{{ structure.tenor_range }}</td></tr>
                    <tr><td>Rate Basis</td><td>{{ structure.rate_basis }}</td></tr>
                    <tr><td>Min Project Size</td><td>{{ structure.min_project_size }}</td></tr>
                </table>
            </div>

            {% if structure.eligibility_notes %}
            <div class="eligibility-notes">
                <h4>Eligibility Notes</h4>
                <ul>
                    {% for note in structure.eligibility_notes %}
                    <li>{{ note }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if structure.advantages %}
            <div class="structure-pros">
                <h4>Advantages</h4>
                <ul>
                    {% for a in structure.advantages %}
                    <li>{{ a }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            {% if structure.considerations %}
            <div class="structure-cons">
                <h4>Considerations</h4>
                <ul>
                    {% for c in structure.considerations %}
                    <li>{{ c }}</li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</section>

<!-- Term Sheets -->
{% if term_sheets %}
<section class="results-section">
    <h2>Indicative Term Sheets</h2>
    <p>The following term sheets are indicative only and do not constitute binding offers.</p>

    {% for ts in term_sheets %}
    <div class="term-sheet">
        <h3>{{ ts.title }}</h3>
        <p class="term-sheet-date">Generated: {{ ts.date_generated }}</p>

        <!-- Basic Terms -->
        <div class="term-section">
            <h4>Key Terms</h4>
            <table class="data-table">
                {% for key, val in ts.key_terms.items() %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ val }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <!-- Security Package -->
        {% if ts.security %}
        <div class="term-section">
            <h4>Security Package</h4>
            <ul>
                {% for s in ts.security %}
                <li>{{ s }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Conditions Precedent -->
        {% if ts.conditions_precedent %}
        <div class="term-section">
            <h4>Conditions Precedent</h4>
            <ul>
                {% for cp in ts.conditions_precedent %}
                <li>{{ cp }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Financial Covenants -->
        {% if ts.covenants %}
        <div class="term-section">
            <h4>Financial Covenants</h4>
            <table class="data-table">
                {% for key, val in ts.covenants.items() %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ val }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}

        <!-- Reserves -->
        {% if ts.reserves %}
        <div class="term-section">
            <h4>Reserve Accounts</h4>
            <table class="data-table">
                {% for key, val in ts.reserves.items() %}
                <tr>
                    <td>{{ key }}</td>
                    <td>{{ val }}</td>
                </tr>
                {% endfor %}
            </table>
        </div>
        {% endif %}
    </div>
    {% endfor %}
</section>
{% endif %}

<!-- Actions -->
<section class="results-actions">
    <a href="{{ url_for('analysis.results') }}" class="btn btn-secondary">Back to Results</a>
    <a href="{{ url_for('report.summary_report') }}" class="btn btn-primary">Full Report</a>
    {% if rus_eligible %}
    <a href="{{ url_for('report.rus_201') }}" class="btn btn-primary">RUS Form 201</a>
    {% endif %}
    {% if lpo_eligible %}
    <a href="{{ url_for('report.lpo_xvii') }}" class="btn btn-primary">DOE LPO Application</a>
    {% endif %}
</section>
{% endblock %}
